<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!--禁止缓存-->
	<META HTTP-EQUIV="pragma" CONTENT="no-cache">
	<META HTTP-EQUIV="Cache-Control" CONTENT="no-store, must-revalidate">
	<META HTTP-EQUIV="expires" CONTENT="Wed, 26 Feb 1997 08:21:57 GMT">
	<META HTTP-EQUIV="expires" CONTENT="0">
    <title>江苏省两化深度融合诊断服务平台 | 推进两化深度融合，助力江苏制造业高质量发展</title>
	<meta name="keywords" content="两化融合,工业诊断,数字化,企业信息化,江苏制造业,制造业转型,智能制造,工业互联网,企业上云,精益生产">
	<meta name="description" content="江苏省两化深度融合诊断服务平台：实施线上诊断与线下服务，给出适合企业的精益之路，推进两化深度融合，助力江苏制造业高质量发展。">

    <!-- 页头  页脚样式 -->
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link rel="stylesheet" href="../js/layui/css/layui.css">
    <style>
        /* 样式改写 */
        .layui-form-checkbox[lay-skin=primary]:hover i {
        border-color: #1f8dfb;
        color: #fff;
        }
        .layui-form-checked[lay-skin=primary] i {
            border-color: #1f8dfd!important;
            background-color: #1f8dfb;
            color: #fff;
        }
        /* 复用样式 */
        .myFuyong{
            font-size: 14px;color: #1f8dfb;cursor: pointer;
        }
        a:hover {
                    color: #1f8dfb;
                }
        /* 最外层盒子 */
        .myBox01{
            border:1px solid #c6c6c6;
            width: 600px;height: 400px;
            margin: 0 auto;
            /* translate: -50%; */
            border-radius: 10px;
            background-color: 	#fffcfc;
        }
        .myBox02{
            margin-left: 90px;margin-top: 50px;
        }
        /* 登录title */
        .myDenglu{
            width: 400px;position: relative;
        }
        .myDenglu > div:first-child > span {
            font-weight: 700;font-size: 24px;
            font-family: Avenir,Helvetica,Arial,sans-serif;
            color: #1f8dfb;
        }
        .myDenglu > div:last-child {
            position: absolute;bottom: 0;right: 0;
        }
        .myDenglu > div:last-child > span:first-child {
            font-size: 14px;
        }
        /* 账号登录 */
        .myZhanghao{
            width: 400px;margin-top: 30px;
        }
        .myZhanghao > input:last-child {
            margin-top: 15px;
        }
        /* 账号登录切换 默认隐藏 */
        #myZhanghao{
            display: none;
        }
        /* 手机号登录  默认隐藏*/
        .myShouji{
            width: 400px;
        }
        .myShouji > div:first-child{
            position: relative;
        }
        .myShouji > div:first-child > span {
            display:block;position:absolute;
            top: 9px;padding-left: 10px;
        }
        .myShouji > div:first-child > input {
            margin-top: 30px;padding-left: 105px;
        }
        .myShouji > div:last-child {
            display: flex;
            justify-content: space-between;
        }
        .myShouji > div:last-child > input {
            margin-top: 15px;
        }
        .myShouji > div:last-child > button {
            margin-top: 15px;margin-left: 10px;
        }
        /* 登录切换 */
        .myQiehuan{
            margin-top: 10px;
        }
        /* 登录按钮 */
        .myClassbtn{
            width: 400px;
        }
        .myClassbtn > button {
            margin-top: 30px;width: 100%;
        }
        /* 记住密码 */
        .myJizhu{
            width: 400px;margin-top: 15px;
            display: flex;justify-content: space-between;
        }
        .myJizhu > div:last-child > a {
            cursor: pointer;
        }
        /* 忘记密码 */
        .forget01{
            margin-left: 335px;
        }
        /* 内容区域 */
        .container{
            margin-top: 150px;
        }
        .cont_box{
            width: 1198px;margin: 0 auto 150px;
            /* border: 1px solid #e0e0e0;padding: 50px 0px; */
        }
        /* ie edge 自带眼睛去除 */
        input::-ms-clear{display:none;}
        input::-ms-reveal{display:none;}
    </style>
</head>
<body   style="font-family: 微软雅黑;">
    <!-- 页头 -->
    <script src="../js/public/header.js"></script>

    <div class="container" id="pageOne">
      <div class="cont_box">
            <div class="myBox01">
              <div class="myBox02">
                  <!-- 登录 -->
                  <div class="login-panel-title myDenglu">
                      <div>
                          <span>欢迎登录</span>
                      </div>
                      <div>
                          <span>没有账号？</span>
                          <!-- <span><a class="myFuyong" href="http://njtesthoneycomb.zhizaoyun.com/register" target="_blank">立即注册</a></span> -->
                          <span><a class="myFuyong" href="https://ulogin.zhizaoyun.com/register" target="_blank">立即注册</a></span>
                      </div>
                  </div>
                  <!-- 账号 -->
                  <div class="account">
                      <form class="layui-form" action="" lay-filter="example">
                          <div class="myZhanghao">
                              <input type="hidden" name="type" value="0" />
                              <input type="text" name="username" lay-verify="required" placeholder="请输入您的账号" class="layui-input">
                              <input type="password" name="password" lay-verify="required" placeholder="请输入您的密码" autocomplete="off" class="layui-input" style="margin-top:15px">
                              <div style="width:32px;height:32px;margin-left: 340px;margin-top: -34px;margin-right: 20px;cursor: pointer;">
                                <img class="yanjing" src="../images/eye_close.png">
                              </div>
                              <!-- 登录按钮 -->

                              <div class="myQiehuan">
                                <span class="myFuyong toggle one">手机验证码登录</span>
                                <span class="myFuyong toggle two" style="display:none;">密码登录</span>
                            </div>

                              <div class="myClassbtn">
                                  <button id="myDing" type="button" lay-submit  lay-filter="accountSubmit" class="layui-btn layui-btn-normal">登录</button>
                              </div>
                          </div>
                      </form>
                  </div>

                  <!-- 手机号 -->
                  <div class="iphone" style="display: none">
                      <form class="layui-form" action="" lay-filter="exampleIphone">
                          <div class="myShouji">
                              <div>
                                  <span>+86 (中国大陆)</span>
                                  <input id="inputVal" type="text" name="iphone" lay-verify="required|phone" placeholder="请输入您的手机号" autocomplete="off" class="layui-input">
                              </div>
                              <div>
                                  <input type="text" name="sms" lay-verify="required|number" placeholder="请输入短信验证码" autocomplete="off" class="layui-input">
                                  <button type="button" class=" layui-btn layui-btn-normal myHuoqu">获取短信验证码</button>
                              </div>
                          </div>
                          <!-- 登录按钮 -->

                          <div class="myQiehuan">
                            <span class="myFuyong toggle one">手机验证码登录</span>
                            <span class="myFuyong toggle two" style="display:none;">密码登录</span>
                        </div>

                          <div class="myClassbtn">
                              <button id="myDing01" type="button" lay-submit lay-filter="iphoneSubmit" class="layui-btn layui-btn-normal">登录</button>
                          </div>
                      </form>
                  </div>

                  <!-- 切换登录方式 -->
                  <!-- <div class="myQiehuan">
                      <span class="myFuyong toggle one">手机验证码登录</span>
                      <span class="myFuyong toggle two" style="display:none;">密码登录</span>
                  </div> -->

                  <!-- 记住密码 -->
                    <div class="myJizhu">
                        <div id="remember" style="position: relative;">
                            <label style="cursor: pointer;">
                                <input class="chceckboxCli" style="cursor: pointer;height: 20px;width: 20px;position: absolute;" type="checkbox" lay-skin="primary" value="1" lay-filter="jizhuMima">&nbsp;&nbsp;<span style="margin-left: 20px;">记住密码</span>
                            </label>
                        </div>
                        <div class="forget">
                            <!-- <a class="myFuyong" href="http://njtesthoneycomb.zhizaoyun.com/forget" target="_blank">忘记密码?</a> -->
                            <a class="myFuyong" href="https://ulogin.zhizaoyun.com/forget" target="_blank">忘记密码?</a>
                        </div>
                    </div>
              </div>
          </div>
      </div>
  </div>
      <!-- 页脚 -->
	<script src="../js/public/foot.js"></script>

<script type="text/javascript" src="../js/jquery.min.js"></script>
<script src="../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../js/layui/layui.all.js"></script>
<script type="text/javascript" src="../js/common.js"></script>

<script type="text/javascript">
layui.use(['form','layedit','laydate'], function () {
    var form = layui.form
    ,layer = layui.layer
    form.render();
    getCookie()

    form.verify({
        number: [
            /^\d{6}$/,
            '验证码格式不正确'
                ],
        });


    // 睁眼闭眼
    $(".yanjing").click(function(){
        // console.log('打一下')
        if($("input[name='password']").attr("type") == 'text'){
            $("input[name='password']").attr("type", "password");
            $(".yanjing").attr('src','../images/eye_close.png');
        }else{
            $("input[name='password']").attr("type", "text");
            $(".yanjing").attr('src','../images/eye_open.png');
        }
    });

    // 切换登陆方式
    $('.toggle').click(function () {
        if ($(this).text() == '手机验证码登录') {
            $('.iphone').show()
            $('.account').hide()
            $('.one').hide()
            $('.two').show()
            $('#remember').hide()
            $('.forget').addClass('forget01')
        } else {
            $('.iphone').hide()
            $('.account').show()
            $('.one').show()
            $('.two').hide()
            $('#remember').show()
            $('.forget').removeClass('forget01')
        }
        // $('input').val("");
        // 验证码清空
        $('input[name="sms"]').val("");
    })

    // 记住密码
    $('.chceckboxCli').click(function () {
        if($("input[type=checkbox]").prop("checked")){
            $('input[type=checkbox]:checked').each(function() {
                var username = $("input[name='username']").val()
                var password = $("input[name='password']").val()
                setCookie(username, password, 7 ,$(this).val())
            });
        }else{
            clearCookie()
        }
    })


    // 监听提交
    form.on('submit(accountSubmit)', function(data){
        $('#myDing').addClass('layui-btn-disabled')
        $('#myDing').attr("disabled", true)

        // 记住密码
        if($("input[type=checkbox]").prop("checked")){
            $('input[type=checkbox]:checked').each(function() {
                var username = $("input[name='username']").val()
                var password = $("input[name='password']").val()
                setCookie(username, password, 7 ,$(this).val())
            });
        }else{
            clearCookie()
        }

        var loginData = { }
            loginData = data.field;
            loginData.type = 0;
            // console.log(loginData)
        // 账号密码登陆
        $.ajax({
            type : 'post',
            url : ajaxUrl + "auth/login",
            data: data.field,
            dataType: 'json',
            xhrFields: {
            withCredentials: true
            },
            crossDomain: true,
            success : function(res) {
                if (res.code == 200) {

                    // console.log(res.data.account.userInfo.username)
                    // 调取总接口
                    sessionStorage.setItem('username', res.data.account.userInfo.username)
                    $.ajax({
                        type : 'get',
                        url : ajaxUrl + "apply/main",
                        dataType: 'json',
                        xhrFields: {
                        withCredentials: true
                        },
                        crossDomain: true,
                        success : function(res) {
                            // console.log(res)
                            if (res.code == 200) {
                                if(res.auth == 0){
                                    //  企业报名完成状态
                                    if(res.data.length > 0){
                                        layer.msg('登录成功，即将跳转...');
                                        setTimeout(function () {
                                            // 跳转到企业信息展示
                                            window.location.href = './submitCompleted.html?nav=0'
                                            $('#myDing').removeClass('layui-btn-disabled')
                                            $('#myDing').attr("disabled", false)

                                        }, 500)
                                    }
                                } else if ( res.auth == 1 ){
                                    //  企业报名未完成状态
                                    layer.msg('登录成功，即将跳转...');
                                    setTimeout(function () {
                                        // 跳转到企业信息提示
                                        window.location.href = './enroll.html?nav=0'
                                        $('#myDing').removeClass('layui-btn-disabled')
                                        $('#myDing').attr("disabled", false)

                                    }, 500)
                                }else if( res.auth == 2 ){
                                    //  企业报名完成状态 , 试卷完成状态
                                    layer.msg('登录成功，即将跳转...');
                                    setTimeout(function () {
                                        // 跳转到试卷加载页面
                                        window.location.href = './companyApprovalResult/approvalResult.html?nav=2'
                                        $('#myDing').removeClass('layui-btn-disabled')
                                        $('#myDing').attr("disabled", false)

                                    }, 500)
                                }else{
                                    //  其他状态 ,
                                    layer.msg('登录成功，即将跳转...');
                                    setTimeout(function () {
                                        // 跳转到试卷提示
                                        window.location.href = './qiyeTishi.html?nav=1'
                                        $('#myDing').removeClass('layui-btn-disabled')
                                        $('#myDing').attr("disabled", false)

                                    }, 500)
                                }
                            }
                            loginData = null;
                        } ,
                        error : function(err) {
                            layer.msg("请求失败");
                            $('#myDing').removeClass('layui-btn-disabled')
                            $('#myDing').attr("disabled", false)

                        }
                    })
                } else {
                    layer.msg(res.msg);
                    $('#myDing').removeClass('layui-btn-disabled')
                    $('#myDing').attr("disabled", false)

                }
            },
            error : function(err) {
                layer.msg('请求错误');
                $('#myDing').removeClass('layui-btn-disabled')
                $('#myDing').attr("disabled", false)

            }
        })
        return false;
    });

    //获取手机验证码
    var loginShouji = { }
    $('.myHuoqu').click(function(){
        // 按钮不可用
        var time = 60;
        $('.myHuoqu').addClass('layui-btn-disabled')
        $('.myHuoqu').attr("disabled", true)
    if ($('input[name="iphone"]').val().length < 1) {
        layer.msg ('请输入11位手机号！');
        $('.myHuoqu').removeClass('layui-btn-disabled')
        $('.myHuoqu').attr("disabled", false)
    }else if (!(/^1[3456789]\d{9}$/.test($('input[name="iphone"]').val()))) {
        layer.msg( '手机号码有误，请重新输入！');
        $('.myHuoqu').removeClass('layui-btn-disabled')
        $('.myHuoqu').attr("disabled", false)
    }else{
            timeval = setInterval(function(){
                if(time > 1){
                    time --
                    $('.myHuoqu').html('重新发送('+time+')')
                }else if(time == 1){
                    clearInterval(timeval)
                    $('.myHuoqu').removeClass('layui-btn-disabled')
                    $('.myHuoqu').attr("disabled", false)
                    $('.myHuoqu').html('重新获取验证码')
                }
            },1000)
            var data = {}
            data.phone = $('input[name="iphone"]').val()
            $.ajax({
                type : 'post',
                url : ajaxUrl + "auth/sendVerifyCode",
                data: data,
                dataType: 'json',
                success : function(res) {
                    if (res.code == 200) {
                        var smsUuid = JSON.parse(res.data.sendResult.result);
                        loginShouji.uuid = smsUuid.data.smsUuid;
                    }
                    else {
                        layer.msg(res.msg);
                        clearInterval(timeval);
                        $('.myHuoqu').html('获取短信验证码')
                        $('.myHuoqu').removeClass('layui-btn-disabled')
                        $('.myHuoqu').attr("disabled", false)
                    }
                },
                error : function(err) {
                    layer.msg('请求错误');
                    clearInterval(timeval);
                    $('.myHuoqu').html('获取短信验证码')
                    $('.myHuoqu').removeClass('layui-btn-disabled')
                    $('.myHuoqu').attr("disabled", false)
                }
            })
        }
    })
    // 手机号登陆
    form.on('submit(iphoneSubmit)', function(data){
        $('#myDing01').addClass('layui-btn-disabled')
        $('#myDing01').attr("disabled", true)
        loginShouji.iphone = data.field.iphone;
        loginShouji.code = data.field.sms;
        // 发送请求
        $.ajax({
            type : 'post',
            url : ajaxUrl + "auth/loginSms?phone="+loginShouji.iphone+'&code='+loginShouji.code+'&uuid='+loginShouji.uuid,
            // data: loginShouji,
            dataType: 'json',
            xhrFields: {
            withCredentials: true
            },
            crossDomain: true,
            success : function(res) {
                if (res.code == 200) {

                    sessionStorage.setItem('username', res.data.account.userInfo.username)
                    // 调取总接口
                    $.ajax({
                        type : 'get',
                        url : ajaxUrl + "apply/main",
                        dataType: 'json',
                        xhrFields: {
                        withCredentials: true
                        },
                        crossDomain: true,
                        success : function(res) {
                            // console.log(res)
                            if (res.code == 200) {
                                if(res.auth == 0){
                                    //  企业报名完成状态
                                    if(res.data.length > 0){
                                        layer.msg('登录成功，即将跳转...');
                                        setTimeout(function () {
                                            // 跳转到企业信息展示
                                            window.location.href = './submitCompleted.html?nav=0'
                                            $('#myDing01').removeClass('layui-btn-disabled')
                                            $('#myDing01').attr("disabled", false)

                                        }, 500)
                                    }

                                } else if ( res.auth == 1 ){
                                    //  企业报名未完成状态
                                    layer.msg('登录成功，即将跳转...');
                                    setTimeout(function () {
                                        // 跳转到企业信息提示
                                        window.location.href = './enroll.html?nav=0'
                                        $('#myDing01').removeClass('layui-btn-disabled')
                                        $('#myDing01').attr("disabled", false)

                                    }, 500)
                                }else if( res.auth == 2 ){
                                    //  企业报名完成状态 , 试卷完成状态
                                    layer.msg('登录成功，即将跳转...');
                                    setTimeout(function () {
                                        // 跳转到试卷加载
                                        window.location.href = './companyApprovalResult/approvalResult.html?nav=2'
                                        $('#myDing01').removeClass('layui-btn-disabled')
                                        $('#myDing01').attr("disabled", false)

                                    }, 500)
                                }else{
                                    //  其他状态 ,
                                    layer.msg('登录成功，即将跳转...');
                                    setTimeout(function () {
                                        // 跳转到试卷提示
                                        window.location.href = './qiyeTishi.html?nav=1'
                                        $('#myDing01').removeClass('layui-btn-disabled')
                                        $('#myDing01').attr("disabled", false)

                                    }, 500)
                                }
                            }
                            loginShouji = null;
                        } ,
                        error : function(err) {
                            layer.msg("请求失败");
                            $('#myDing01').removeClass('layui-btn-disabled')
                            $('#myDing01').attr("disabled", false)

                        }
                    })
                } else {
                    layer.msg(res.msg);
                    $('#myDing01').removeClass('layui-btn-disabled')
                    $('#myDing01').attr("disabled", false)

                }
            },
            error : function(err) {
                layer.msg('请求错误');
                $('#myDing01').removeClass('layui-btn-disabled')
                $('#myDing01').attr("disabled", false)

            }
        })
        return false;
    });

    // 设置cookie
    function setCookie(username, password, exdays,checkbox) {
        var exdate = new Date(); //获取时间
        exdate.setTime(exdate.getTime() + 24 * 60 * 60 * 500 * exdays); //保存的天数
        //字符串拼接cookie
        window.document.cookie = "username" + "=" + username + ";path=/;expires=" + exdate.toGMTString();
        window.document.cookie = "password" + "=" + password + ";path=/;expires=" + exdate.toGMTString();
        window.document.cookie = "checkbox" + "=" + checkbox + ";path=/;expires=" + exdate.toGMTString();
    }
    // 读取cookie
    function getCookie() {
        // console.log(document.cookie.length)
        if (document.cookie.length > 0) {
            let arr = document.cookie.split('; '); //这里显示的格式需要切割一下自己可输出看下
            for (let i = 0; i < arr.length; i++) {
                let arr2 = arr[i].split('='); //再次切割
                //判断查找相对应的值
                if (arr2[0] == 'username') {
                    $("input[name='username']").val(arr2[1]); //保存到保存数据的地方
                } else if (arr2[0] == 'password') {
                    $("input[name='password']").val(arr2[1]);
                } else if(arr2[0] == 'checkbox'){
                    if(arr2[1] == '1'){
                        $('input[type=checkbox]').prop('checked',true)
                    }
                }
            }
        }
    }
    // 清除cookie
    function clearCookie() {
        setCookie('', '', -1,0); //修改2值都为空，天数为负1天就好了
    }
})
</script>

<!-- 百度统计代码 -->
<script>
    /*制造云全站*/
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?6d0c6f3521dfad65307b120c3dbc89bc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
<script>
    /*江苏诊断平台*/
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?23626bd15d8ecf521e03ba03b0f2eca0";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
<script>
    /*判断入口*/
    function checkIsIEView() {
        try {
            var status = window.external.isIEViewer();
            if (status == 1) {
                return true;
            } else {
                return false;
            }
        } catch (e) {
            return false;
        }
    }
    /*PC客户端/PC网页端*/
    var isOn = checkIsIEView();
    if (isOn) {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?4830e1584feb0161d16abb6d4938a601";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    } else {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?ac5827d87107aa017ca84a83ac6bd1a1";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    }
</script>
</body>
</html>
